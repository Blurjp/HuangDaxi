<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:v="urn:schemas-microsoft-com:vml">
<head> 
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/> 
<title>TripShare - Edit Trip</title> 
<link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="TripShare Feed Search"/> 
<link rel="stylesheet" href="{{ static_url("stylesheets/CalendarControl2.css") }}" type="text/css"/>
<link rel="stylesheet" href="{{ static_url("stylesheets/base_packaged.css") }}" type="text/css" media="screen"/>  
<link rel="stylesheet" href="{{ static_url("stylesheets/nano.css") }}" type="text/css"/> 
<link rel="stylesheet" href="{{ static_url("stylesheets/css/jquery-ui-1.8.16.custom.css") }}" type="text/css"/>
<script src="{{ static_url("javascript/CalendarControl.js") }}" type="text/javascript"></script>
<script type="text/javascript" src="{{ static_url("javascript/js/jquery-1.4.4.min.js") }}"></script>
<script type="text/javascript" src="{{ static_url("javascript/js/jquery-ui-1.8.16.custom.min.js") }}"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false&amp;libraries=geometry,places"></script>
<script src="{{ static_url("javascript/settingpopup.js") }}" type="text/javascript"></script>
<script src="{{ static_url("javascript/followuser.js") }}" type="text/javascript"></script>
<script src="{{ static_url("javascript/editmap.js") }}" type="text/javascript"></script>
<script src="{{ static_url("javascript/importguide.js") }}" type="text/javascript"></script>
<script src="{{ static_url("javascript/js/all.js") }}" type="text/javascript"></script> 
<script src="{{ static_url("javascript/createtripslides.js") }}" type="text/javascript"></script>

<script src="{{ static_url("javascript/search.js") }}" type="text/javascript"></script>
</head> 
<body onload="initialize()"> 

<div id="header"> 
<div id="nav-bar">
 {% include "../Module/headline.html" %}
 {% include "../Module/usersetting.html" %}
 {% include "../Guides/ImportGuide.html" %}
</div> 
</div> 
 
<div class="clearfix" id="container"> 
<div class="clearfix" id="content"> 


<div class="box-bar"> 


<div class="profile withbar">
<div class="header">
{% if singletrip %}
<div class="profile">
	<a href="{{singletrip['slug']}}" class="l_editpicture" title="Change picture"><img class="picture large" src="http://localhost/static/images/site.jpg" alt="{{singletrip['title']}}" class="picture large"></a>
</div>
<div class="body">

<ul class="trip_action_options">
<li>	
<input type="button" class="regular-button discusstrip" href="#discuss_trip" value="Discuss">
</li>
<li>	
<input type="button" class="regular-button importguide" href="#import_guide_step_1" value="Import Guide">
</li>
</ul> 



<h1><a class="name" href="{{singletrip['slug']}}">{{singletrip['title']}}</a> </h1>
<a href="#" class="l_editprofile" uid={{singletrip['trip_id']}}>edit settings</a>
{% end %}
</div>
</div>
<div style="clear:both"></div>



<ul id="trip_tag" onmouseover="trip_tag_add_show(true);" onmouseout="trip_tag_add_show(false);" style="display:block">
{% for tag in singletrip['tags']%}
<li class="tag_button">
  <a class="tag_button_add" rel="tag" href="/tag">{{tag}}</a>
  <div class="tag_button_remove" ></div>
  <div style="clear:both"></div>
</li>
{% end %}

<li id="trip_tag_add_show" onclick="trip_tag_add_form_toggle(true); event.stopPropagation(); return false">
</li>
  
<li id="trip_tag_add_form">
   <div id="trip_tag_add_input_exterior" style="position: relative; float: left">
   <div id="trip_tag_add_input_exterior">
   <input type="text" id="trip_tag_add_input" default_value="add tag" tip="add tag" css_size="small" autocomplete="off" class="input_inactive_small">
   </div>
   </div>    
    <a style="margin:3px 0 0 9px; cursor: pointer; float: left; font-weight: bold; color: #428EDA" onclick="trip_tag_add_form_toggle(false); return false">done</a>
  </li>
  
  <div style="clear:both"></div>
  
</ul>



<div class="conv-head"> 
<ul class="trip_member_tabs trip_member_groups_list">

<li class="on droppable">

<ul class="trip_member" style="display:block"> 
{% for member in singletrip['members'] %}
<li class="draggable">
<span class="headpichold">
<a style="cursor:pointer;" href="/people/{{member['slug']}}">
<img class="picture medium" alt="{{member['username']}}"  src="{{member['picture']}}" >
</a>
</span>
<div sid="{{member['user_id']}}" class="member_button_remove"></div> 
</li>
{% end %}

<li class="trip_member_add_form_show">
</li>
<li class="trip_member_add_form">
<div class="trip_member_add_input_exterior">
<input type="text" class="trip_member_add_input" default_value="add member" tip="add member" css_size="small" autocomplete="off" class="input_inactive_small">
<div class="people_search_result_in_trip">
<ul class="people_search_result_list"></ul>
</div>
</div>
<a class="trip_member_add_form_hide">done</a>
</li>

</ul>
<li class="new_trip_tab droppable">
	<ul class="trip_member" style="display:block">
	<li class="trip_member_add_form_show">
</li>
<li class="trip_member_add_form">
<div class="trip_member_add_input_exterior">
<input type="text" class="trip_member_add_input" default_value="add member" tip="add member" css_size="small" autocomplete="off" class="input_inactive_small">
<div class="people_search_result_in_trip">
<ul class="people_search_result_list"></ul>
</div>
</div>
<a class="trip_member_add_form_hide">done</a>
</li>
	</ul>
</li>	
</li>
</ul>
<div class="member_count"><a href="/managemember/{{singletrip['slug']}}"><span class="num">{{ len(singletrip['members']) }}</span> member</a>
</div>
</div>


 
</div>
</div>
 <div style="clear:both"></div>
<script type='text/javascript'>
var trip_tag_add_form_displayed;
function trip_tag_add_show(status)
{
	
    if(!$('#trip_tag_add_show').length) { return; } 
    
    if(status && !trip_tag_add_form_displayed)
    {
        $('#trip_tag_add_show').show();
    }
    else
    {
        $('#trip_tag_add_show').hide();
    }
}

function trip_tag_add_form_toggle(display)
{ 
    if(display)
    {
        trip_tag_add_form_displayed = true;
        
        $('#trip_tag').show();
        $('#trip_tag_add_show').hide(); 
        $('#trip_tag_add_form').show(); 
        
        // Show remove buttons for each category
        var plan_category_as = $('#trip_tag').find('.tag_button_add');
        
        if(plan_category_as)
        {
            plan_category_as.addClass('tag_button_a_edit_active');
        }
        
        var plan_category_removes = $('#trip_tag').find('.tag_button_remove');
        
        if(plan_category_removes)
        {
            plan_category_removes.show();
        }

        setTimeout("$('#trip_tag_add_input').focus();", 50);
    }
    else
    { 
        trip_tag_add_form_displayed = false;
        
        $('#trip_tag_add_form').hide(); 
        $('#trip_tag_add_show').show();
        
        // Show remove buttons for each category
		if($('#trip_tag_add_input').val() != '')
		{
		var content ={'tag':$('#trip_tag_add_input').val(),'trip_id':$('#tripId').val(),'_xsrf':getCookie('_xsrf')};
        $.postJSON('/add_trip_tag', content, function(response){
			    ShowTripTag($('#trip_tag_add_input').val());
		});
		}
		else
		{
		var plan_category_removes = $('#trip_tag').find('.tag_button_remove');
        
        if(plan_category_removes)
        {
            plan_category_removes.hide();
        }
		}
    }
}

function ShowTripTag(tag)
{
	if(tag!='')
	{
	var node = $('<li class="tag_button"><a class="tag_button_add tag_button_a_edit_active" rel="tag" href="/tag">'+tag+'</a><div class="tag_button_remove" style="display: block; "></div></li>');
	node.insertBefore($('#trip_tag_add_show'));
	$('#trip_tag_add_input').val('');
	 
    }
	var plan_category_removes = $('#trip_tag').find('.tag_button_remove');
        
        if(plan_category_removes)
        {
            plan_category_removes.hide();
        }
	
}
</script>

<script type='text/javascript'>
	
$('.trip_member').live('mouseover',function(){
	trip_member_add_show(true, $(this));
});
$('.trip_member').live('mouseleave',function(){
	trip_member_add_show(false, $(this));
});
var trip_member_add_form_displayed;

//var $tabs = $('.conv-head').tabs();
//var selected  = $tabs.tabs('option', 'selected');
function trip_member_add_show(status, object)
{
    
    if(!object.children('.trip_member_add_form_show').length) { return; } 
    
    if(status && !trip_member_add_form_displayed)
    {
        object.children('.trip_member_add_form_show').show();
    }
    else
    {
        object.children('.trip_member_add_form_show').hide();
    }
}

$('.trip_member_add_form_show').live('click',function(){
	trip_member_add_form_displayed = true;
	$(this).closest('.trip_member').show();
    $(this).hide(); 
    $(this).siblings('.trip_member_add_form').show(); 
	var plan_category_as =  $(this).closest('.trip_member').find('.member_button_add');
        
        if(plan_category_as)
        {
            plan_category_as.addClass('member_button_a_edit_active');
        }
        
        var plan_category_removes =  $(this).closest('.trip_member').find('.member_button_remove');
        
        if(plan_category_removes)
        {
            plan_category_removes.show();
        }

        setTimeout("$('.trip_member_add_input').focus();", 50);
});

$('.trip_member_add_form_hide').live('click',function(){
	 trip_member_add_form_displayed = false;
        
        $(this).closest('.trip_member_add_form').hide(); 
        $(this).parent().siblings('.trip_member_add_show').show();
        
        // Show remove buttons for each category
		
		//alert($(this).siblings().children('.trip_member_add_input').attr('class'));
		
		if($(this).siblings().children('.trip_member_add_input').val() != '')
		{
			//alert($(this).parents('.trip_member').children('.trip_member_add_input').val());
	          $(this).siblings().children('.trip_member_add_input').val('');
		//alert('test1');
		}
		else
		{
		var plan_category_removes = $(this).parents('.trip_member').children('.draggable').children('.member_button_remove');
		
        if(plan_category_removes)
        {
		//	alert('test');
            plan_category_removes.hide();
        }
		}
});

$('.add_user_to_trip').live('click',function()
{
	var content = {"trip_id":$('#tripId').val(), "user_id":$(this).attr('sid'), "_xsrf":getCookie("_xsrf")};
	$.postJSON('/addusertotrip', content, function(response){
		if(response=='existed')
		{
			alert('User already exist in this trip.');
		}
		else if (response != '') {
			
			var user = JSON.parse(response);
			var node = $('<li><span class="headpichold"><a style="cursor:pointer;" href="/people/'+user["slug"]+'"><img class="picture medium" alt="'+user['username']+'"  src="'+user['picture']+'" ></a></span><div sid="'+user['user_id']+'" class="member_button_remove"></div></li>');
	        alert($(this).parents('.trip_member').attr('class'));
			node.insertBefore($(this).parents('.trip_member').find('.trip_member_add_form_show'));
			
		    trip_member_add_form_displayed = false;
        
		//alert($('.trip_member_add_form').attr('class'));
        $(this).parents('.trip_member_add_form').hide();
        $(this).parents('.trip_member_add_form').siblings('.trip_member_add_form_show').show();
        
        // Show remove buttons for each category
		if($(this).parents('.trip_member_add_form').children('.trip_member_add_input').val() != '')
		{
	          $(this).parents('.trip_member_add_form').children('.trip_member_add_input').val('');
		}
		else
		{
		var plan_category_removes = $(this).parents('.trip_member_add_form').siblings().children('.member_button_remove');
        
        if(plan_category_removes)
        {
            plan_category_removes.hide();
        }
		}
			alert('User has been added to the trip.');
			return false;
		}
		else
		{alert('failed');}
	});
});

function trip_member_add_form_toggle(display,object)
{ 
object = $(object);
    if(display)
    {
        trip_member_add_form_displayed = true;
        
        object.closest('.trip_member').show();
        object.hide(); 
        object.siblings('#trip_member_add_form').show(); 
        
        // Show remove buttons for each category
        var plan_category_as =  object.closest('.trip_member').find('.member_button_add');
        
        if(plan_category_as)
        {
            plan_category_as.addClass('member_button_a_edit_active');
        }
        
        var plan_category_removes =  object.closest('.trip_member').find('.member_button_remove');
        
        if(plan_category_removes)
        {
            plan_category_removes.show();
        }

        setTimeout("$('.trip_member_add_input').focus();", 50);
    }
    else
    { 
        trip_member_add_form_displayed = false;
        
        object.siblings('#trip_member_add_form').hide(); 
        object.show();
        
        // Show remove buttons for each category
		if($('.trip_member_add_input').val() != '')
		{
	          $('.trip_member_add_input').val('');
		}
		else
		{
		var plan_category_removes = object.closest('.trip_member').find('.member_button_remove');
        
        if(plan_category_removes)
        {
            plan_category_removes.hide();
        }
		}
    }
}

function ShowTripmember(member)
{
	if(member!='')
	{
	var node = $('<li class="member_button"><a class="member_button_add member_button_a_edit_active" rel="member" href="/member">'+member+'</a><div class="member_button_remove" style="display: block; "></div></li>');
	node.insertBefore($('.trip_member_add_show'));
	$('.trip_member_add_input').val('');
	 
    }
	var plan_category_removes = $('.trip_member').find('.member_button_remove');
        
        if(plan_category_removes)
        {
            plan_category_removes.hide();
        }
	
}
</script>

<div id="body"> 
<div id="map-canvas"></div>
<div style="clear:both"></div>

<div id="social">
<ul>
<li original-title="Tweet This"><span class="twitter_custom" onclick="TwitterShare()">&nbsp;</span></li>
<li original-title="Share This on Facebook"><span class="facebook_custom" onclick="FBShare()">&nbsp;</span></li>
<li original-title="Submit This to Reddit"><span class="reddit_custom" onclick="RedditShare()">&nbsp;</span></li>
<li original-title="Submit This to Digg"><span class="digg_custom" onclick="DiggShare()">&nbsp;</span></li>
<li original-title="Submit This to Stumble Upon"><span class="stumbleupon_custom" onclick="StumbleShare()">&nbsp;</span></li>

<!--
<li original-title="Tweet This"><span class="twitter_custom" onclick="javascript:new_window('http://twitter.com/share?url=http://www.tripshare.cc/trip/'+{{singletrip['slug']}}+';text='+"{{singletrip['title']}}"+';via=tripshare', 550, 425)">&nbsp;</span></li>
<li original-title="Share This on Facebook"><span class="facebook_custom" onclick="javascript:new_window('http://www.facebook.com/sharer.php?u=http://www.tripshare.cc/trip/'+{{singletrip['slug']}}+';t='+{{singletrip['title']}}, 755, 425)">&nbsp;</span></li>
<li original-title="Submit This to Reddit"><span class="reddit_custom" onclick="javascript:new_window('http://reddit.com/submit?url=http://www.tripshare.cc/trip/'+{{singletrip['slug']}}+';title='+{{singletrip['title']}}, 900, 720)">&nbsp;</span></li>
<li original-title="Submit This to Digg"><span class="digg_custom" onclick="javascript:new_window('http://digg.com/submit?phase=2&amp;url=http://www.tripshare.cc/trip/'+{{singletrip['slug']}}+';title='+{{singletrip['title']}}, 1060, 655)">&nbsp;</span></li>
<li original-title="Submit This to Stumble Upon"><span class="stumbleupon_custom" onclick="javascript:new_window('http://www.stumbleupon.com/submit?url=http://www.tripshare.cc/trip/'+{{singletrip['slug']}}+';title='+{{singletrip['title']}}, 1060, 500)">&nbsp;</span></li>
------->
<li original-title="Email This"><a href="javascript:void(0)" class="addthis_button_email st_email_custom at300b" title="Email"><span>&nbsp;</span></a></li><li original-title="More Sharing Options"><span class="addthis_button st_sharethis_custom"><span>&nbsp;</span></span></li>
</ul>
</div>
	
<div class="map-detail" type="hidden">

				<input name="username" id="username" type="hidden" value="{{current_user['username']}}" > 
				<input name="tripId" id="tripId" type="hidden" value = "{{singletrip['trip_id']}}">
                <input name="startPlace" id="startPlace" type="hidden" value = "{{singletrip['start_place']}}"> 
                <input name="dest_place" id="dest_place" type="hidden" value = "{{dest_place}}">  
				<input name="startPosition" id="startPosition" type="hidden" value = "{{singletrip['start_place_position']}}"> 
				<input name="wayPoints" id="wayPoints" type="hidden" value = "{{singletrip['way_points']}}"> 
                <input name="encodedPolyline" id="encodedPolyline" type="hidden" value = "{{singletrip['trip_path']}}">  
                <input name="result" id="result" type="hidden" value=''> 
				<input name="slug" id="trip_slug" type="hidden" value = "{{singletrip['slug']}}"> 
				<input name="title" id="trip_title" type="hidden" value = "{{singletrip['title']}}">
				<input name="typeId" id="typeId" type="hidden" value = "{{singletrip['trip_id']}}"> 
				<input id="type" type="hidden" value = "trip">
               
</div> 

<div class='overview'>
	<div class="left">
    	{%if current_user%}
    <img alt="{{current_user['username']}}" src="{{current_user['picture']}}" title="{{current_user['username']}}" class="picture medium "> 
	   {%else%}
	<img alt="guest" src="{{ static_url("images/guest.png") }}" title="guest" class="picture medium">    
	   {%end%}
     </div>
	<div class="comment post">
		<form action="#" method="post">
		{% raw xsrf_form_html() %}
        <div class="FORM-text">
        <div class="area">
        <input type="text" name="feedBody" class="feedBody" placeholder="Post a comment…">
        </div>
        </div>
        <input type="button" class="post-button postfeed" href="#post_feed" value="Post">
        </form>
     </div>
	 <div style="clear:both"></div>
	 <ul class="feedsUI">
	 	<li></li>
		  {% include "../Module/comment.html" %}
	</ul>
</div>

</div> 

<div id="photoBarBg" class="right" >
<div class="first"></div>
<div class="middle"></div>
<div class="last"></div>
</div>

<div id="photoBarContent" class="right">
<div class="photoRank first" id="photoRank">
<a href="">Drag to add Destination: <img src="{{ static_url("images/tag.png") }}" title="Drag to add destination" border="0" hspace="0" vspace="0" onload="" style="margin-bottom: 5px;"></a>
</div>

<div class="mapfilter" id="mapfilter"><h4>Show</h4><ul><li><img src="{{ static_url("icon/park.png") }}" title="Show park" border="0" hspace="0" vspace="0" onload="" style="margin-bottom: 5px;"></li>
<li><img src="{{ static_url("icon/hotel.png") }}" title="Show hotel" border="0" hspace="0" vspace="0" onload="" style="margin-bottom: 5px;"></li>
<li><img src="{{ static_url("icon/gas.png") }}" title="Show gas station" border="0" hspace="0" vspace="0" onload="" style="margin-bottom: 5px;"></li>
<li><img src="{{ static_url("icon/camping.png") }}" title="Show camping place" border="0" hspace="0" vspace="0" onload="" style="margin-bottom: 5px;"></li>
</ul>
</div>
<div class="mapfilter" id="mapfilter2"><h4>Show</h4><ul>
<li><img src="{{ static_url("icon/Cafe.png") }}" title="Show Cafe" border="0" hspace="0" vspace="0" onload="" style="margin-bottom: 5px;"></li>
<li><img src="{{ static_url("icon/restaurant.png") }}" title="Show restaurant" border="0" hspace="0" vspace="0" onload="" style="margin-bottom: 5px;"></li>
<li><img src="{{ static_url("icon/bar.png") }}" title="Show bar" border="0" hspace="0" vspace="0" onload="" style="margin-bottom: 5px;"></li>
</ul>
</div>
<div id="photoExif"><a href=""><img id="photoInfoButton" src="{{ static_url("images/spacer.gif") }}" width="27" height="27" border="0" title="Photo Information" alt="Photo Information"></a>
</div>
<div id="photoSave"><img id="savePhotoButton" src="{{ static_url("images/spacer.gif") }}" width="28" height="31" border="0" style="cursor:pointer" alt="Save Photo" title="Save Photo">
</div>
</div>




{% include "trip_sites.html" %}

{% include "../Module/CreateTripSlide1.html" %}
<!-- AddThis script-->
<script type="text/javascript" src="http://s7.addthis.com/js/250/addthis_widget.js#pubid=xa-4e1d7b7d69c15ffd"></script>
<!-- AddThis Button END -->

{% include "../Module/footer.html" %} 

</body> 
</html>


 



